{"version":3,"sources":["../../src/modules/paramValidation.js"],"names":["validateValue","validateParams","defaultAssert","isBoolean","value","areParamPairsEmpty","paramPairs","Array","isArray","length","isInputEmpty","input","Object","getOwnPropertyNames","name","type","defaultValue","assertValid","reason","isValid","error","message","toString","Boolean","params","spec","inputValues","assign","missingParams","filter","hasOwnProperty","call","param","map","join","every","paramSpec"],"mappings":";;;;;;;;;;;QAmBgBA,a,GAAAA,a;QA8BAC,c,GAAAA,c;;AA/ChB;;;;AACA;;AACA;;;;AAGA,IAAMC,gBAAgB,+BAAW,sBAAX,CAAtB;;AAGO,IAAMC,gCAAY,SAAZA,SAAY,CAACC,KAAD;AAAA,SAAgB,OAAOA,KAAP,KAAiB,SAAjC;AAAA,CAAlB;;AAEA,IAAMC,kDAAqB,SAArBA,kBAAqB,CAACC,UAAD;AAAA,SAChCA,cAAc,IAAd,IAAuBC,MAAMC,OAAN,CAAcF,UAAd,KAA6BA,WAAWG,MAAX,KAAsB,CAD1C;AAAA,CAA3B;;AAGA,IAAMC,sCAAe,SAAfA,YAAe,CAACC,KAAD;AAAA,SAC1BA,SAAS,IAAT,IACC,sBAAcA,KAAd,KAAwBC,OAAOC,mBAAP,CAA2BF,KAA3B,EAAkCF,MAAlC,KAA6C,CAF5C;AAAA,CAArB;;AAIA,SAAST,aAAT,CACLI,KADK,QAIL;AAAA;AAAA,MAFCU,IAED;AAAA,MAFOC,IAEP;AAAA,MAFaC,YAEb;;AAAA,MADAC,WACA,uEADgCf,aAChC;;AACA,MAAIgB,eAAJ;AACA,MAAIC,UAAU,KAAd;;AAEA,MAAI;AACFA,cAAU,mCACR,OAAOf,KAAP,KAAiB,WAAjB,GAA+BA,KAA/B,GAAuCY,YAD/B,EAERD,IAFQ,CAAV;AAID,GALD,CAKE,OAAOK,KAAP,EAAc;AACdF,aAASE,MAAMC,OAAN,IAAiBD,MAAME,QAAN,EAA1B;AACD;;AAED,SAAOL,YACLM,QAAQJ,OAAR,CADK,kBAESL,IAFT,oCAE4CC,IAF5C,UAGHG,gBAAcA,MAAd,SAA0B,EAHvB,EAAP;AAMD;;AAED;;;;;AAKO,SAASjB,cAAT,CACLuB,MADK,EAELC,IAFK,EAII;AAAA,MADTR,WACS,uEADuBf,aACvB;;AACT,MAAIG,mBAAmBoB,IAAnB,KAA4Bf,aAAac,MAAb,CAAhC,EAAsD;AACpD,WAAO,IAAP;AACD;;AAEDP,cAAY,sBAAcO,MAAd,CAAZ,EAAmC,kCAAnC;;AAEA,MAAME,cAAcd,OAAOe,MAAP,CAAc,EAAd,EAAkBH,MAAlB,CAApB;;AAEA;AACA;AACA,MAAMI,gBAAgBH,KAAKI,MAAL,CACpB;AAAA,WACE,EACEjB,OAAOkB,cAAP,CAAsBC,IAAtB,CAA2BL,WAA3B,EAAwCM,MAAM,CAAN,CAAxC,KAAqDA,MAAMvB,MAAN,KAAiB,CADxE,CADF;AAAA,GADoB,CAAtB;;AAOAQ,cACEW,cAAcnB,MAAd,KAAyB,CAD3B,4BAE0BmB,cAAcK,GAAd,CAAkB;AAAA;AAAA,QAAEnB,IAAF;;AAAA,WAAYA,IAAZ;AAAA,GAAlB,EAAoCoB,IAApC,CAAyC,IAAzC,CAF1B;;AAKA,SAAOT,KAAKU,KAAL,CAAW;AAAA,WAChBnC,cAAc0B,YAAYU,UAAU,CAAV,CAAZ,CAAd,EAAyCA,SAAzC,CADgB;AAAA,GAAX,CAAP;AAGD","file":"paramValidation.js","sourcesContent":["/* @flow */\n\nimport isPlainObject from 'lodash.isplainobject';\nimport { makeAssert } from '@colony/colony-js-utils';\nimport { validateValueType } from './paramTypes';\nimport type { Params, Param } from '../flowtypes';\n\nconst defaultAssert = makeAssert('Parameter Validation');\ntype AssertionMethod = (assertion: boolean, reason: string) => any;\n\nexport const isBoolean = (value: any) => typeof value === 'boolean';\n\nexport const areParamPairsEmpty = (paramPairs: Params) =>\n  paramPairs == null || (Array.isArray(paramPairs) && paramPairs.length === 0);\n\nexport const isInputEmpty = (input: any) =>\n  input == null ||\n  (isPlainObject(input) && Object.getOwnPropertyNames(input).length === 0);\n\nexport function validateValue(\n  value: any,\n  [name, type, defaultValue]: Param,\n  assertValid?: AssertionMethod = defaultAssert,\n) {\n  let reason;\n  let isValid = false;\n\n  try {\n    isValid = validateValueType(\n      typeof value !== 'undefined' ? value : defaultValue,\n      type,\n    );\n  } catch (error) {\n    reason = error.message || error.toString();\n  }\n\n  return assertValid(\n    Boolean(isValid),\n    `Parameter \"${name}\" expected a value of type \"${type}\"${\n      reason ? ` (${reason})` : ''\n    }`,\n  );\n}\n\n/**\n * Given parameters (as an object with named parameters, but potentially any\n * kind of invalid input), validate each parameter against the expected type\n * for this method, throwing vaidation errors or returning true.\n */\nexport function validateParams(\n  params?: any,\n  spec: Params,\n  assertValid?: AssertionMethod = defaultAssert,\n): boolean {\n  if (areParamPairsEmpty(spec) && isInputEmpty(params)) {\n    return true;\n  }\n\n  assertValid(isPlainObject(params), 'Expected parameters as an object');\n\n  const inputValues = Object.assign({}, params);\n\n  // Either the parameter name should exist in the inputValues,\n  // or the parameter should have a default value.\n  const missingParams = spec.filter(\n    param =>\n      !(\n        Object.hasOwnProperty.call(inputValues, param[0]) || param.length === 3\n      ),\n  );\n\n  assertValid(\n    missingParams.length === 0,\n    `Missing parameters: \"${missingParams.map(([name]) => name).join(', ')}\"`,\n  );\n\n  return spec.every(paramSpec =>\n    validateValue(inputValues[paramSpec[0]], paramSpec),\n  );\n}\n"]}